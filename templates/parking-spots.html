{% extends "base.html" %} {% block title %}Parking Spots - {{
parking_lot.location_name }}{% endblock %} {% block content %}
<div class="row mb-4">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center">
      <div>
        <h2><i class="fas fa-car me-2"></i>Parking Spots</h2>
        <p class="text-muted mb-0">
          {{ parking_lot.location_name }} - {{ parking_lot.address }}
        </p>
      </div>
      <a
        href="{{ url_for('manage_parking') }}"
        class="btn btn-outline-secondary"
      >
        <i class="fas fa-arrow-left me-2"></i>Back to Parking Lots
      </a>
    </div>
  </div>
</div>

<!-- Parking Lot Info -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card-body" style="background-color: #dfd0b8; color: #393e46">
        <div class="row">
          <div class="col-md-3 text-center">
            <h5>{{ parking_lot.total_spots }}</h5>
            <small class="text-muted">Total Spots</small>
          </div>
          <div class="col-md-3 text-center">
            <h5>
              {% set available_spots = spot_details|selectattr('spot.status',
              'equalto', 'A')|list|length %} {{ available_spots }}
            </h5>
            <small class="text-muted">Available Spots</small>
          </div>
          <div class="col-md-3 text-center">
            <h5>
              {% set occupied_spots = spot_details|selectattr('spot.status',
              'equalto', 'O')|list|length %} {{ occupied_spots }}
            </h5>
            <small class="text-muted">Occupied Spots</small>
          </div>
          <div class="col-md-3 text-center">
            <h5>â‚¹ {{ "%.2f"|format(parking_lot.hourly_rate) }}</h5>
            <small class="text-muted">Price per Hour</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Parking Spots Grid -->
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-header" style="background-color: #948979">
        <h5><i class="fas fa-list me-2"></i>All Parking Spots</h5>
      </div>
      <div class="card-body" style="background-color: #dfd0b8">
        {% if spot_details %}
        <div class="row">
          {% for spot_detail in spot_details %}
          <div class="col-md-3 col-sm-6 mb-3">
            <div
              class="card {% if spot_detail.spot.status == 'O' %}border-danger{% else %}border-success{% endif %}"
            >
              <div
                class="card-body text-center rounded border"
                style="color: black"
              >
                <h5 class="card-title">
                  <i class="fas fa-car me-2"></i>Spot {{
                  spot_detail.spot.spot_number }}
                </h5>

                {% if spot_detail.spot.status == 'A' %}
                <span class="badge mb-2" style="background-color: #393e46"
                  >Available</span
                >
                <p class="small">Ready for booking</p>
                {% else %}
                <span
                  class="badge mb-2"
                  style="background-color: #dfd0b8; color: #393e46"
                  >Occupied</span
                >
                {% if spot_detail.reservation %}
                <div class="text-start">
                  <p class="mb-1">
                    <strong>Booked By:</strong> {{
                    spot_detail.reservation.user.username }}
                  </p>
                  <p class="mb-1">
                    <strong>Booked At:</strong> {{
                    spot_detail.reservation.entry_time.strftime('%Y-%m-%d %H:%M') }}
                  </p>
                  <p class="mb-0">
                    <strong>Duration:</strong> {{
                    spot_detail.reservation.duration_hours }}h {{
                    spot_detail.reservation.duration_minutes }}m
                  </p>
                </div>
                {% endif %} {% endif %}
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="text-center py-4">
          <i class="fas fa-car fa-3x text-muted mb-3"></i>
          <h5 class="text-muted">No Parking Spots Found</h5>
          <p class="text-muted">This parking lot has no spots configured.</p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Detailed Table View -->
<div class="row mt-4">
  <div class="col-12">
    <div class="card">
      <div
        class="card-header"
        style="background-color: #948979; color: #222831"
      >
        <h5><i class="fas fa-table me-2"></i>Detailed View</h5>
      </div>
      <div class="card-body" style="background-color: #dfd0b8">
        {% if spot_details %}
        <div class="table-responsive">
          <table class="table table-hover">
            <thead style="background-color: #948979">
              <tr>
                <th>Spot Number</th>
                <th>Status</th>
                <th>User</th>
                <th>Parking Time</th>
                <th>Duration</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody style="border-bottom: #222831">
              {% for spot_detail in spot_details %}
              <tr>
                <td>
                  <strong>Spot {{ spot_detail.spot.spot_number }}</strong>
                </td>
                <td>
                  {% if spot_detail.spot.status == 'A' %}
                  <span class="badge" style="background-color: #222831"
                    >Available</span
                  >
                  {% else %}
                  <span class="badge" style="background-color: #948979"
                    >Occupied</span
                  >
                  {% endif %}
                </td>
                <td>
                  {% if spot_detail.reservation %} {{
                  spot_detail.reservation.user.username }} {% else %}
                  <span class="text-muted">-</span>
                  {% endif %}
                </td>
                <td>
                  {% if spot_detail.reservation %} {{
                  spot_detail.reservation.entry_time.strftime('%Y-%m-%d
                  %H:%M') }} {% else %}
                  <span class="text-muted">-</span>
                  {% endif %}
                </td>
                <td>
                  {% if spot_detail.reservation %} {{
                  spot_detail.reservation.duration_hours }}h {{
                  spot_detail.reservation.duration_minutes }}m {% else %}
                  <span class="text-muted">-</span>
                  {% endif %}
                </td>
                <td>
                  {% if spot_detail.spot.status == 'O' and
                  spot_detail.reservation %}
                  <span class="text-muted">Active reservation</span>
                  {% else %}
                  <span class="text-muted">No action needed</span>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <p class="text-muted text-center">No parking spots to display.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
