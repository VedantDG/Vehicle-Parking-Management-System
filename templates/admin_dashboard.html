{% extends "base.html" %} {% block title %}Admin Dashboard - Parking Management
System{% endblock %} {% block content %}
<div class="row mb-4">
  <div class="col-12" style="color: #dfd0b8">
    <h2><i class="fas fa-tachometer-alt me-2"></i>Admin Dashboard</h2>
    <p>Welcome back, {{ session['admin_username'] }}!</p>
  </div>
</div>

<!-- Statistics Cards Starts -->
<div class="row mb-4">
  <div class="col-md-3 mb-3">
    <div
      class="card stats-card"
      style="
        background: linear-gradient(
          to right,
          rgba(0, 0, 0, 0.9),
          rgba(50, 50, 50, 0.7)
        );
      "
    >
      <div class="card-body text-center">
        <i class="fas fa-building fa-2x mb-2"></i>
        <h4>{{ parking_lots|length }}</h4>
        <p class="mb-0">Parking Lots</p>
      </div>
    </div>
  </div>

  <div class="col-md-3 mb-3">
    <div
      class="card stats-card"
      style="
        background: linear-gradient(
          to right,
          rgba(0, 0, 0, 0.9),
          rgba(50, 50, 50, 0.7)
        );
      "
    >
      <div class="card-body text-center">
        <i class="fas fa-car fa-2x mb-2"></i>
        <h4>{{ total_spots }}</h4>
        <p class="mb-0">Total Spots</p>
      </div>
    </div>
  </div>

  <div class="col-md-3 mb-3">
    <div
      class="card stats-card"
      style="
        background: linear-gradient(
          to right,
          rgba(0, 0, 0, 0.9),
          rgba(50, 50, 50, 0.7)
        );
      "
    >
      <div class="card-body text-center">
        <i class="fas fa-check-circle fa-2x mb-2"></i>
        <h4>{{ available_spots }}</h4>
        <p class="mb-0">Available Spots</p>
      </div>
    </div>
  </div>

  <div class="col-md-3 mb-3">
    <div
      class="card stats-card"
      style="
        background: linear-gradient(
          to right,
          rgba(0, 0, 0, 0.9),
          rgba(50, 50, 50, 0.7)
        );
      "
    >
      <div class="card-body text-center">
        <i class="fas fa-users fa-2x mb-2"></i>
        <h4>{{ users|length }}</h4>
        <p class="mb-0">Registered Users</p>
      </div>
    </div>
  </div>
</div>
<!-- Statistics Cards Ends-->

<!-- Quick Actions Starts-->
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div
        class="card-header"
        style="background-color: #948979; color: #222831"
      >
        <h5><i class="fas fa-bolt me-2"></i>Quick Actions</h5>
      </div>
      <div class="card-body" style="background-color: #dfd0b8">
        <div class="row">
          <div class="col-md-4 mb-2">
            <a
              href="{{ url_for('manage_parking') }}"
              class="btn w-100"
              style="background-color: #948979; color: #222831"
            >
              <i class="fas fa-plus me-2"></i>Add Parking Lot
            </a>
          </div>
          <div class="col-md-4 mb-2">
            <a
              href="{{ url_for('manage_parking') }}"
              class="btn w-100"
              style="background-color: #948979; color: #222831"
            >
              <i class="fas fa-building me-2"></i>Manage Parking Lots
            </a>
          </div>
          <div class="col-md-4 mb-2">
            <button
              class="btn w-100"
              onclick="refreshStats()"
              style="background-color: #948979; color: #222831"
            >
              <i class="fas fa-sync-alt me-2"></i>Refresh Stats
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Quick Actions Ends-->

<!-- Charts Row Starts-->
<div class="row mb-4">
  <div class="col-md-6 mb-3">
    <div class="card">
      <div
        class="card-header"
        style="background-color: #948979; color: #222831"
      >
        <h5><i class="fas fa-chart-pie me-2"></i>Parking Spot Status</h5>
      </div>
      <div class="card-body" style="background-color: #dfd0b8; color: #222831">
        <canvas id="spotStatusChart" width="400" height="200"></canvas>
      </div>
    </div>
  </div>

  <div class="col-md-6 mb-3">
    <div class="card">
      <div
        class="card-header"
        style="background-color: #948979; color: #222831"
      >
        <h5><i class="fas fa-chart-bar me-2"></i>Parking Lots Overview</h5>
      </div>
      <div class="card-body" style="background-color: #dfd0b8; color: #222831">
        <canvas id="parkingLotsChart" width="400" height="200"></canvas>
      </div>
    </div>
  </div>
</div>
<!-- Charts Row Ends-->

<!-- Recent Activity Starts-->
<div class="row">
  <div class="col-md-6 mb-3">
    <div class="card">
      <div
        class="card-header"
        style="background-color: #948979; color: #222831"
      >
        <h5><i class="fas fa-building me-2"></i>Recent Parking Lots</h5>
      </div>
      <div class="card-body" style="background-color: #dfd0b8; color: #222831">
        {% if parking_lots %}
        <div class="list-group list-group-flush">
          {% for lot in parking_lots[:5] %}
          <div
            class="list-group-item d-flex justify-content-between align-items-center"
            style="background-color: #dfd0b8; color: #222831"
          >
            <div>
              <h6 class="mb-1">{{ lot.location_name }}</h6>
              <small class="text-muted">{{ lot.address }}</small>
            </div>
            <p class="text-muted mb-0">
              <span class="badge bg-secondary">{{ lot.total_spots }} spots</span>
            </p>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <p class="text-muted" style="background-color: #dfd0b8; color: #222831">
          No parking lots created yet.
        </p>
        {% endif %}
      </div>
    </div>
  </div>

  <div class="col-md-6 mb-3">
    <div class="card">
      <div
        class="card-header"
        style="background-color: #948979; color: #222831"
      >
        <h5><i class="fas fa-users me-2"></i>Recent Users</h5>
      </div>
      <div class="card-body" style="background-color: #dfd0b8; color: #222831">
        {% if users %}
        <div class="list-group list-group-flush">
          {% for user in users[:5] %}
          <div
            class="list-group-item d-flex justify-content-between align-items-center"
            style="background-color: #dfd0b8; color: #222831"
          >
            <div>
              <h6 class="mb-1">{{ user.username }}</h6>
              <small class="text-muted">{{ user.email }}</small>
            </div>
            <small class="text-muted"
              >{{ user.created_at.strftime('%Y-%m-%d') }}</small
            >
          </div>
          {% endfor %}
        </div>
        {% else %}
        <p class="text-muted">No users registered yet.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>
<!-- Recent Activity Ends-->
{% endblock %} {% block scripts %}
<!-- Chart.js Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Create data arrays for charts
    const lotNames = [];
    const lotSpots = [];
    {% for lot in parking_lots %}
      lotNames.push('{{ lot.location_name }}');
      lotSpots.push({{ lot.total_spots }});
    {% endfor %}

    // Parking Spot Status Chart
    const spotCtx = document.getElementById('spotStatusChart').getContext('2d');
    const spotChart = new Chart(spotCtx, {
        type: 'doughnut',
        data: {
            labels: ['Available', 'Occupied'],
            datasets: [{
                data: [{{ available_spots }}, {{ occupied_spots }}],
                backgroundColor: ['#222831', '#948979'],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

    // Parking Lots Chart
    const lotsCtx = document.getElementById('parkingLotsChart').getContext('2d');
    const lotsChart = new Chart(lotsCtx, {
        type: 'bar',
        data: {
            labels: lotNames,
            datasets: [
                {
                    label: "Total Spots",
                    data: lotSpots,
                    backgroundColor: "rgba(54, 162, 235, 0.2)",
                    borderColor: "rgba(54, 162, 235, 1)",
                    borderWidth: 1,
                },
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true
                }
            },
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
  });

  // Update the page with new stats
  function refreshStats() {
      fetch('/api/parking_stats')
          .then(response => response.json())
          .then(data => {
              location.reload();
          })
          .catch(error => {
              console.error('Error fetching stats:', error);
          });
  }
</script>
{% endblock %}
